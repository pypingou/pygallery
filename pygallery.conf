# /etc/httpd/conf.d/gallery.conf
# This configuration assumes your photo gallery container is accessible
# internally via http://<container_internal_ip>:5000/

<VirtualHost *:80>
    ServerName example.com # Replace with your actual domain or server IP
    # ServerName your_fedora_server_ip_or_domain # Example if using IP directly

    # ProxyPass for the /gallery subpath
    # Requests to http://example.com/gallery will be proxied to the container's root
    ProxyPreserveHost On
    ProxyRequests Off

    # Map /gallery/ to the container's root.
    # The '!' excludes paths that should not be proxied (e.g., if you had other /gallery/ subpaths on Apache)
    # The 'nocanon' is often needed to prevent Apache from normalizing URLs prematurely,
    # which can interfere with Flask's URL matching.
    ProxyPass /gallery/ http://172.17.0.2:5000/gallery/ nocanon # IMPORTANT: Add /gallery/ to container path
    ProxyPassReverse /gallery/ http://172.17.0.2:5000/gallery/ # IMPORTANT: Add /gallery/ to container path

    # If you have static files that Flask also serves, you might need specific rules:
    # Example for static files served by Flask:
    # ProxyPass /gallery/static/ http://172.17.0.2:5000/gallery/static/ nocanon
    # ProxyPassReverse /gallery/static/ http://172.17.0.2:5000/gallery/static/

    # Optional: Add error logging
    ErrorLog /var/log/httpd/gallery_error.log
    CustomLog /var/log/httpd/gallery_access.log combined

    # Required for Apache 2.4+ when using ProxyPass and container is not directly exposed
    <Directory />
        Require all granted
    </Directory>
</VirtualHost>

