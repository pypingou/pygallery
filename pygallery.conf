# /etc/httpd/conf.d/gallery.conf
# This configuration assumes your pygallery container is accessible
# internally via http://<container_internal_ip>:5000/

<VirtualHost *:80>
    ServerName your_domain_or_server_ip # e.g., example.com

    ProxyPreserveHost On
    ProxyRequests Off

    # Get container's internal IP with: podman inspect pygallery-app | grep -i "IPAddress"
    # Example IP: 172.17.0.2 (this will vary based on your Podman network)

    # IMPORTANT: Replace <BASE_URL_PREFIX> with the exact value
    # you have set in your config.ini (e.g., /gallery, /myphotos, etc.)
    # If BASE_URL_PREFIX is empty in config.ini (for root deployment),
    # then these lines would simply be:
    # ProxyPass / http://<container_internal_ip>:5000/ nocanon
    # ProxyPassReverse / http://<container_internal_ip>:5000/

    # Proxy the gallery application
    ProxyPass /<BASE_URL_PREFIX>/ http://<container_internal_ip>:5000/<BASE_URL_PREFIX>/ nocanon
    ProxyPassReverse /<BASE_URL_PREFIX>/ http://<container_internal_ip>:5000/<BASE_URL_PREFIX>/

    # Explicitly proxy the static files path for the gallery
    # This ensures that Apache correctly forwards requests for CSS, JS, images etc.
    ProxyPass /<BASE_URL_PREFIX>/static/ http://<container_internal_ip>:5000/<BASE_URL_PREFIX>/static/ nocanon
    ProxyPassReverse /<BASE_URL_PREFIX>/static/ http://<container_internal_ip>:5000/<BASE_URL_PREFIX>/static/

    ErrorLog /var/log/httpd/gallery_error.log
    CustomLog /var/log/httpd/gallery_access.log combined

    # --- HTTP Basic Authentication for the /<BASE_URL_PREFIX>/ path ---
    # This section protects the specific URL path where your gallery is served.
    <Location /<BASE_URL_PREFIX>>
        AuthType Basic
        AuthName "Restricted Gallery Access"
        # Path to your .htpasswd file
        # IMPORTANT: Replace /etc/httpd/.htpasswd with the actual path to your password file
        AuthUserFile /etc/httpd/.htpasswd
        Require valid-user
    </Location>
    # ------------------------------------------------------------------

    <Directory />
        # This Directory block should generally be permissive for the root
        # and more specific restrictions handled by Location blocks.
        Require all granted
    </Directory>
</VirtualHost>

